<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Status Panel</title>
    <link rel="stylesheet" href="../static/css/mdui.min.css" />
    <script src="../static/js/mdui.min.js"></script>
    <script src="../static/js/socket.io.js"></script>
    <script src="../static/js/jquery.js"></script>
</head>

<body
    class="mdui-appbar-with-toolbar mdui-theme-primary-indigo mdui-theme-accent-pink mdui-theme-layout-auto mdui-loaded">

    <header class="appbar mdui-appbar mdui-appbar-fixed">
        <div class="mdui-toolbar mdui-color-theme">
            <a href="javascript:;" class="mdui-typo-title">HUAT-FSAC Status Panel</a>
            <div class="mdui-toolbar-spacer"></div>
            <a href="/" class="mdui-btn mdui-btn-icon">
                <i class="mdui-icon material-icons">refresh</i>
            </a>
            <a href="javascript:;" class="mdui-btn mdui-btn-icon">
                <i class="mdui-icon material-icons">more_vert</i>
            </a>
        </div>
    </header>

    <div class="container mdui-container">
        <h1>IMU Report:</h1>
        <div class="mdui-row">
            <div class="mdui-col-xs-3">
                <div class="mdui-card">
                    <div class="mdui-card-primary">
                        <div class="mdui-card-primary-title">Current Speed:</div>
                        <div class="mdui-card-primary-subtitle">Measured from IMU</div>
                    </div>

                    <div class="mdui-card-content">
                        <span id="current_speed"></span><span> km/h</span>
                    </div>
                </div>
            </div>
            <div class="mdui-col-xs-9">
                <div class="mdui-card">
                    <div class="mdui-card-primary">
                        <div class="mdui-card-primary-title">Current Location:</div>
                        <div class="mdui-card-primary-subtitle">Measured from IMU</div>
                    </div>
                    <!-- TODO: add map media -->
                    <div class="mdui-card-content">{{current_lat}}°, {{current_lon}}°</div>
                </div>
            </div>
        </div>

        <h1>VCU Report:</h1>
    </div>

    <script>
        var connection_failn = 0;
        //TODO rewrite using $.ajax

        function getUpdate() {
            $.get('/update', function (data) {
                connection_failn = 0;
                var speed = jQuery.parseJSON(data).speed;
                console.log(speed)
                $('#current_speed').text(speed);
            });

            if (connection_failn > 5) {
                mdui.$.snackbar({
                    message: 'Archived',
                    buttonText: 'undo',
                    onClick: function () {
                        mdui.alert('点击了 Sanckbar');
                    },
                    onButtonClick: function () {
                        mdui.alert('点击了按钮');
                    },
                    onClose: function () {
                        mdui.alert('关闭了');
                    }
                });
            }
        }

        setInterval(getUpdate, 1000);
    </script>
</body>

</html>